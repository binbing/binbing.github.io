<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="部署 Master本部分将说明如何建立与设定 Kubernetes Master 角色，过程中会部署以下元件：  kube-apiserver：提供 REST APIs，包含授权、认证与状态储存等。 kube-controller-manager：负责维护集群的状态，如自动扩展，滚动更新等。 kube-scheduler：负责资源排程，依据预定的排程策略将 Pod 分配到对应节点上。 Etcd：储">
<meta property="og:type" content="article">
<meta property="og:title" content="虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master">
<meta property="og:url" content="xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/index.html">
<meta property="og:site_name" content="萧非瑟">
<meta property="og:description" content="部署 Master本部分将说明如何建立与设定 Kubernetes Master 角色，过程中会部署以下元件：  kube-apiserver：提供 REST APIs，包含授权、认证与状态储存等。 kube-controller-manager：负责维护集群的状态，如自动扩展，滚动更新等。 kube-scheduler：负责资源排程，依据预定的排程策略将 Pod 分配到对应节点上。 Etcd：储">
<meta property="og:updated_time" content="2018-08-20T10:12:03.591Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master">
<meta name="twitter:description" content="部署 Master本部分将说明如何建立与设定 Kubernetes Master 角色，过程中会部署以下元件：  kube-apiserver：提供 REST APIs，包含授权、认证与状态储存等。 kube-controller-manager：负责维护集群的状态，如自动扩展，滚动更新等。 kube-scheduler：负责资源排程，依据预定的排程策略将 Pod 分配到对应节点上。 Etcd：储">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 02 生成证书/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#部署-Master"><span class="toc-number">1.</span> <span class="toc-text">部署 Master</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署和设定"><span class="toc-number">1.1.</span> <span class="toc-text">部署和设定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-apiserver-配置"><span class="toc-number">1.1.1.</span> <span class="toc-text">kube-apiserver 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-controller-manager-配置"><span class="toc-number">1.1.2.</span> <span class="toc-text">kube-controller-manager 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-scheduler-配置"><span class="toc-number">1.1.3.</span> <span class="toc-text">kube-scheduler 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#etcd-配置"><span class="toc-number">1.1.4.</span> <span class="toc-text">etcd 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#haproxy-配置"><span class="toc-number">1.1.5.</span> <span class="toc-text">haproxy 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keepalived-配置"><span class="toc-number">1.1.6.</span> <span class="toc-text">keepalived 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kubelet-service-配置"><span class="toc-number">1.1.7.</span> <span class="toc-text">kubelet.service 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动-kubelet"><span class="toc-number">1.2.</span> <span class="toc-text">启动 kubelet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证集群"><span class="toc-number">1.3.</span> <span class="toc-text">验证集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立-TLS-Bootstrapping-RBAC-与-Secret"><span class="toc-number">1.4.</span> <span class="toc-text">建立 TLS Bootstrapping RBAC 与 Secret</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">萧非瑟</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-05-30T17:53:29.000Z" itemprop="datePublished">2018-05-30</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="部署-Master"><a href="#部署-Master" class="headerlink" title="部署 Master"></a>部署 Master</h2><p>本部分将说明如何建立与设定 Kubernetes Master 角色，过程中会部署以下元件：</p>
<ul>
<li>kube-apiserver：提供 REST APIs，包含授权、认证与状态储存等。</li>
<li>kube-controller-manager：负责维护集群的状态，如自动扩展，滚动更新等。</li>
<li>kube-scheduler：负责资源排程，依据预定的排程策略将 Pod 分配到对应节点上。</li>
<li>Etcd：储存集群所有状态的 Key/Value 储存系统。</li>
<li>HAProxy：提供负载平衡器。</li>
<li>Keepalived：提供虚拟网络位址 (VIP)。</li>
</ul>
<h3 id="部署和设定"><a href="#部署和设定" class="headerlink" title="部署和设定"></a>部署和设定</h3><p>首先在所有 Master 节点下载部署元件的 YAML 文件，这边不采用二进制执行档与 Systemd 来管理这些元件，全部采用 Static Pod 来达成。这边将配置文件放到 <code>/etc/kubernetes/manifests</code> 目录。</p>
<p>以下所有操作需要在每个 Master 上都操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /etc/kubernetes/manifests &amp;&amp; cd /etc/kubernetes/manifests</div><div class="line"></div><div class="line">$ # 替换为当前部署的 master 机器 IP</div><div class="line">$ export MASTER_IP=192.168.56.11</div></pre></td></tr></table></figure>
<h4 id="kube-apiserver-配置"><a href="#kube-apiserver-配置" class="headerlink" title="kube-apiserver 配置"></a>kube-apiserver 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/kube-apiserver.yaml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: kube-apiserver</div><div class="line">    tier: control-plane</div><div class="line">  name: kube-apiserver</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers :</div><div class="line">  - name: kube-apiserver</div><div class="line">    image: gcr.io/google_containers/kube-apiserver-amd64:v1.10.3</div><div class="line">    command:</div><div class="line">      - kube-apiserver</div><div class="line">      - --v=0</div><div class="line">      - --logtostderr=true</div><div class="line">      - --allow-privileged=true</div><div class="line">      - --advertise-address=$&#123;MASTER_IP&#125;</div><div class="line">      - --bind-address=$&#123;MASTER_IP&#125;</div><div class="line">      - --insecure-bind-address=$&#123;MASTER_IP&#125;</div><div class="line">      - --secure-port=5443</div><div class="line">      - --insecure-port=7070</div><div class="line">      - --service-cluster-ip-range=10.254.0.0/16</div><div class="line">      - --service-node-port-range=30000-32767</div><div class="line">      - --etcd-servers=https://192.168.56.11:2379,https://192.168.56.12:2379,https://192.168.56.13:2379</div><div class="line">      - --etcd-cafile=/etc/kubernetes/ssl/ca.pem</div><div class="line">      - --etcd-certfile=/etc/etcd/ssl/etcd.pem</div><div class="line">      - --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem</div><div class="line">      - --client-ca-file=/etc/kubernetes/ssl/ca.pem</div><div class="line">      - --tls-cert-file=/etc/kubernetes/ssl/apiserver.pem</div><div class="line">      - --tls-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem</div><div class="line">      - --kubelet-client-certificate=/etc/kubernetes/ssl/apiserver.pem</div><div class="line">      - --kubelet-client-key=/etc/kubernetes/ssl/apiserver-key.pem</div><div class="line">      - --service-account-key-file=/etc/kubernetes/ssl/sa.pub</div><div class="line">      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</div><div class="line">      - --admission-control=Initializers,NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota</div><div class="line">      - --authorization-mode=Node,RBAC</div><div class="line">      - --enable-bootstrap-token-auth=true</div><div class="line">      - --requestheader-client-ca-file=/etc/kubernetes/ssl/ca.pem</div><div class="line">      - --proxy-client-cert-file=/etc/kubernetes/ssl/front-proxy-client.pem</div><div class="line">      - --proxy-client-key-file=/etc/kubernetes/ssl/front-proxy-client-key.pem</div><div class="line">      - --requestheader-allowed-names=aggregator</div><div class="line">      - --requestheader-group-headers=X-Remote-Group</div><div class="line">      - --requestheader-extra-headers-prefix=X-Remote-Extra-</div><div class="line">      - --requestheader-username-headers=X-Remote-User</div><div class="line">      - --audit-log-maxage=30</div><div class="line">      - --audit-log-maxbackup=3</div><div class="line">      - --audit-log-maxsize=100</div><div class="line">      - --audit-log-path=/var/log/kubernetes/audit.log</div><div class="line">      - --audit-policy-file=/etc/kubernetes/audit-policy.yml</div><div class="line">      - --experimental-encryption-provider-config=/etc/kubernetes/encryption.yml</div><div class="line">      - --event-ttl=1h</div><div class="line">    livenessProbe:</div><div class="line">      failureThreshold: 8</div><div class="line">      httpGet:</div><div class="line">        host: 127.0.0.1</div><div class="line">        path: /healthz</div><div class="line">        port: 6443</div><div class="line">        scheme: HTTPS</div><div class="line">      initialDelaySeconds: 15</div><div class="line">      timeoutSeconds: 15</div><div class="line">    resources:</div><div class="line">      requests:</div><div class="line">        cpu: 250m</div><div class="line">    volumeMounts:</div><div class="line">    - mountPath: /var/log/kubernetes</div><div class="line">      name: k8s-audit-log</div><div class="line">    - mountPath: /etc/kubernetes/ssl</div><div class="line">      name: k8s-certs</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/ssl/certs</div><div class="line">      name: ca-certs</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/kubernetes/encryption.yml</div><div class="line">      name: encryption-config</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/kubernetes/audit-policy.yml</div><div class="line">      name: audit-config</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/etcd/ssl</div><div class="line">      name: etcd-ca-certs</div><div class="line">      readOnly: true</div><div class="line">  volumes:</div><div class="line">  - hostPath:</div><div class="line">      path: /var/log/kubernetes</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: k8s-audit-log</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: k8s-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/encryption.yml</div><div class="line">      type: FileOrCreate</div><div class="line">    name: encryption-config</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/audit-policy.yml</div><div class="line">      type: FileOrCreate</div><div class="line">    name: audit-config</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/ssl/certs</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: ca-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/etcd/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: etcd-ca-certs</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ul>
<li>kube-apiserver 中的NodeRestriction 请参考 <a href="https://kubernetes.io/docs/admin/authorization/node/" target="_blank" rel="external">Using Node Authorization</a></li>
</ul>
<p>产生一个用来加密 Etcd 的 Key:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$  head -c 32 /dev/urandom | base64</div><div class="line">TUkHNhh1j+DKsnW3VWK8ZVmfQy3i9a/VaRuoqgha4F4=</div></pre></td></tr></table></figure>
<p><strong>注意每台master节点需要用一样的 Key</strong></p>
<p>在 <code>/etc/kubernetes</code> 目录下建立 encryption.yml 的加密 YAML 文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ cat &lt;&lt;EOF &gt; /etc/kubernetes/encryption.yml</div><div class="line">kind: EncryptionConfig</div><div class="line">apiVersion: v1</div><div class="line">resources:</div><div class="line">  - resources:</div><div class="line">      - secrets</div><div class="line">    providers:</div><div class="line">      - aescbc:</div><div class="line">          keys:</div><div class="line">            - name: key1</div><div class="line">              secret: TUkHNhh1j+DKsnW3VWK8ZVmfQy3i9a/VaRuoqgha4F4=</div><div class="line">      - identity: &#123;&#125;</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<ul>
<li>Etcd 资料加密可参考 <a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/" target="_blank" rel="external">Encrypting data at rest</a></li>
</ul>
<p>在/etc/kubernetes/目录下，建立audit-policy.yml的审计策略 YAML 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ cat &lt;&lt;EOF &gt; /etc/kubernetes/audit-policy.yml</div><div class="line">apiVersion: audit.k8s.io/v1beta1</div><div class="line">kind: Policy</div><div class="line">rules:</div><div class="line">  - level: Metadata</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ul>
<li>Audit Policy 请参考 <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/" target="_blank" rel="external">Auditing</a></li>
</ul>
<h4 id="kube-controller-manager-配置"><a href="#kube-controller-manager-配置" class="headerlink" title="kube-controller-manager 配置"></a>kube-controller-manager 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/kube-controller-manager.yml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: kube-controller-manager</div><div class="line">    tier: control-plane</div><div class="line">  name: kube-controller-manager</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers:</div><div class="line">  - name: kube-controller-manager</div><div class="line">    image: gcr.io/google_containers/kube-controller-manager-amd64:v1.10.3</div><div class="line">    command:</div><div class="line">      - kube-controller-manager</div><div class="line">      - --v=0</div><div class="line">      - --logtostderr=true</div><div class="line">      - --address=127.0.0.1</div><div class="line">      - --root-ca-file=/etc/kubernetes/ssl/ca.pem</div><div class="line">      - --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem</div><div class="line">      - --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem</div><div class="line">      - --service-account-private-key-file=/etc/kubernetes/ssl/sa.key</div><div class="line">      - --kubeconfig=/etc/kubernetes/controller-manager.conf</div><div class="line">      - --leader-elect=true</div><div class="line">      - --use-service-account-credentials=true</div><div class="line">      - --node-monitor-grace-period=40s</div><div class="line">      - --node-monitor-period=5s</div><div class="line">      - --pod-eviction-timeout=2m0s</div><div class="line">      - --controllers=*,bootstrapsigner,tokencleaner</div><div class="line">      - --allocate-node-cidrs=true</div><div class="line">      - --cluster-cidr=172.30.0.0/16</div><div class="line">      - --service-cluster-ip-range=10.254.0.0/16</div><div class="line">      - --node-cidr-mask-size=24</div><div class="line">    livenessProbe:</div><div class="line">      failureThreshold: 8</div><div class="line">      httpGet:</div><div class="line">        host: 127.0.0.1</div><div class="line">        path: /healthz</div><div class="line">        port: 10252</div><div class="line">        scheme: HTTP</div><div class="line">      initialDelaySeconds: 15</div><div class="line">      timeoutSeconds: 15</div><div class="line">    resources:</div><div class="line">      requests:</div><div class="line">        cpu: 200m</div><div class="line">    volumeMounts:</div><div class="line">    - mountPath: /etc/kubernetes/ssl</div><div class="line">      name: k8s-certs</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/ssl/certs</div><div class="line">      name: ca-certs</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/kubernetes/controller-manager.conf</div><div class="line">      name: kubeconfig</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /usr/libexec/kubernetes/kubelet-plugins/volume/exec</div><div class="line">      name: flexvolume-dir</div><div class="line">  volumes:</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: k8s-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/ssl/certs</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: ca-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/controller-manager.conf</div><div class="line">      type: FileOrCreate</div><div class="line">    name: kubeconfig</div><div class="line">  - hostPath:</div><div class="line">      path: /usr/libexec/kubernetes/kubelet-plugins/volume/exec</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: flexvolume-dir</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="kube-scheduler-配置"><a href="#kube-scheduler-配置" class="headerlink" title="kube-scheduler 配置"></a>kube-scheduler 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/kube-scheduler.yml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: kube-scheduler</div><div class="line">    tier: control-plane</div><div class="line">  name: kube-scheduler</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers:</div><div class="line">  - name: kube-scheduler</div><div class="line">    image: gcr.io/google_containers/kube-scheduler-amd64:v1.10.3</div><div class="line">    command:</div><div class="line">      - kube-scheduler</div><div class="line">      - --v=0</div><div class="line">      - --logtostderr=true</div><div class="line">      - --address=127.0.0.1</div><div class="line">      - --leader-elect=true</div><div class="line">      - --kubeconfig=/etc/kubernetes/scheduler.conf</div><div class="line">    livenessProbe:</div><div class="line">      failureThreshold: 8</div><div class="line">      httpGet:</div><div class="line">        host: 127.0.0.1</div><div class="line">        path: /healthz</div><div class="line">        port: 10251</div><div class="line">        scheme: HTTP</div><div class="line">      initialDelaySeconds: 15</div><div class="line">      timeoutSeconds: 15</div><div class="line">    resources:</div><div class="line">      requests:</div><div class="line">        cpu: 100m</div><div class="line">    volumeMounts:</div><div class="line">    - mountPath: /etc/kubernetes/ssl</div><div class="line">      name: k8s-certs</div><div class="line">      readOnly: true</div><div class="line">    - mountPath: /etc/kubernetes/scheduler.conf</div><div class="line">      name: kubeconfig</div><div class="line">      readOnly: true</div><div class="line">  volumes:</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: k8s-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/scheduler.conf</div><div class="line">      type: FileOrCreate</div><div class="line">    name: kubeconfig</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="etcd-配置"><a href="#etcd-配置" class="headerlink" title="etcd 配置"></a>etcd 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/etcd.yml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: etcd</div><div class="line">    tier: control-plane</div><div class="line">  name: etcd</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers:</div><div class="line">  - name: etcd</div><div class="line">    image: gcr.io/google_containers/etcd-amd64:3.1.13</div><div class="line">    command:</div><div class="line">    - etcd</div><div class="line">    - --config-file=/etc/etcd/etcd.config.yml</div><div class="line">    livenessProbe:</div><div class="line">      failureThreshold: 8</div><div class="line">      tcpSocket:</div><div class="line">        port: 2379</div><div class="line">      initialDelaySeconds: 15</div><div class="line">      timeoutSeconds: 15</div><div class="line">    volumeMounts:</div><div class="line">    - mountPath: /etc/etcd/ssl</div><div class="line">      name: etcd-certs</div><div class="line">    - mountPath: /etc/kubernetes/ssl</div><div class="line">      name: kubernetes-certs</div><div class="line">    - mountPath: /etc/etcd/etcd.config.yml</div><div class="line">      name: etcd-conf</div><div class="line">    - mountPath: /var/lib/etcd</div><div class="line">      name: data</div><div class="line">  volumes:</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/etcd/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: etcd-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/kubernetes/ssl</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: kubernetes-certs</div><div class="line">  - hostPath:</div><div class="line">      path: /etc/etcd/etcd.config.yml</div><div class="line">    name: etcd-conf</div><div class="line">  - hostPath:</div><div class="line">      path: /var/lib/etcd</div><div class="line">      type: DirectoryOrCreate</div><div class="line">    name: data</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>etcd.config.yml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/etcd/etcd.config.yml &lt;&lt;EOF</div><div class="line">name: &apos;$&#123;HOSTNAME&#125;&apos;</div><div class="line">data-dir: /var/lib/etcd</div><div class="line">wal-dir: /var/lib/etcd/wal</div><div class="line">snapshot-count: 10000</div><div class="line">heartbeat-interval: 100</div><div class="line">election-timeout: 1000</div><div class="line">quota-backend-bytes: 0</div><div class="line">listen-peer-urls: &apos;https://0.0.0.0:2380&apos;</div><div class="line">listen-client-urls: &apos;https://0.0.0.0:2379&apos;</div><div class="line">max-snapshots: 5</div><div class="line">max-wals: 5</div><div class="line">cors:</div><div class="line">initial-advertise-peer-urls: &apos;https://$&#123;MASTER_IP&#125;:2380&apos;</div><div class="line">advertise-client-urls: &apos;https://$&#123;MASTER_IP&#125;:2379&apos;</div><div class="line">discovery:</div><div class="line">discovery-fallback: &apos;proxy&apos;</div><div class="line">discovery-proxy:</div><div class="line">discovery-srv:</div><div class="line">initial-cluster: &apos;kube-m1=https://192.168.56.11:2380,kube-m2=https://192.168.56.12:2380,kube-m3=https://192.168.56.13:2380&apos;</div><div class="line">initial-cluster-token: &apos;etcd-k8s-cluster&apos;</div><div class="line">initial-cluster-state: &apos;new&apos;</div><div class="line">strict-reconfig-check: false</div><div class="line">enable-v2: true</div><div class="line">enable-pprof: true</div><div class="line">proxy: &apos;off&apos;</div><div class="line">proxy-failure-wait: 5000</div><div class="line">proxy-refresh-interval: 30000</div><div class="line">proxy-dial-timeout: 1000</div><div class="line">proxy-write-timeout: 5000</div><div class="line">proxy-read-timeout: 0</div><div class="line">client-transport-security:</div><div class="line">  ca-file: &apos;/etc/kubernetes/ssl/ca.pem&apos;</div><div class="line">  cert-file: &apos;/etc/etcd/ssl/etcd.pem&apos;</div><div class="line">  key-file: &apos;/etc/etcd/ssl/etcd-key.pem&apos;</div><div class="line">  client-cert-auth: true</div><div class="line">  trusted-ca-file: &apos;/etc/kubernetes/ssl/ca.pem&apos;</div><div class="line">  auto-tls: true</div><div class="line">peer-transport-security:</div><div class="line">  ca-file: &apos;/etc/kubernetes/ssl/ca.pem&apos;</div><div class="line">  cert-file: &apos;/etc/etcd/ssl/etcd.pem&apos;</div><div class="line">  key-file: &apos;/etc/etcd/ssl/etcd-key.pem&apos;</div><div class="line">  peer-client-cert-auth: true</div><div class="line">  trusted-ca-file: &apos;/etc/kubernetes/ssl/ca.pem&apos;</div><div class="line">  auto-tls: true</div><div class="line">debug: false</div><div class="line">log-package-levels:</div><div class="line">log-output: default</div><div class="line">force-new-cluster: false</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="haproxy-配置"><a href="#haproxy-配置" class="headerlink" title="haproxy 配置"></a>haproxy 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/haproxy.yml &lt;&lt;EOF</div><div class="line">kind: Pod</div><div class="line">apiVersion: v1</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: haproxy</div><div class="line">    tier: control-plane</div><div class="line">  name: haproxy</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers:</div><div class="line">  - name: haproxy</div><div class="line">    image: kairen/haproxy:1.7</div><div class="line">    resources:</div><div class="line">      requests:</div><div class="line">        cpu: 100m</div><div class="line">    volumeMounts:</div><div class="line">    - name: cfg-volume</div><div class="line">      readOnly: true</div><div class="line">      mountPath: &quot;/usr/local/etc/haproxy/haproxy.cfg&quot;</div><div class="line">  volumes:</div><div class="line">  - name: cfg-volume</div><div class="line">    hostPath:</div><div class="line">      path: &quot;/etc/haproxy/haproxy.cfg&quot;</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>haproxy.cfg：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /etc/haproxy</div><div class="line"></div><div class="line">$ cat &gt; /etc/haproxy/haproxy.cfg &lt;&lt;EOF</div><div class="line">global</div><div class="line">  log 127.0.0.1 local0</div><div class="line">  log 127.0.0.1 local1 notice</div><div class="line">  tune.ssl.default-dh-param 2048</div><div class="line"></div><div class="line">defaults</div><div class="line">  log global</div><div class="line">  mode http</div><div class="line">  #option httplog</div><div class="line">  option dontlognull</div><div class="line">  timeout connect 5000ms</div><div class="line">  timeout client 50000ms</div><div class="line">  timeout server 50000ms</div><div class="line"></div><div class="line">listen stats</div><div class="line">    bind :9090</div><div class="line">    mode http</div><div class="line">    balance</div><div class="line">    stats uri /haproxy_stats</div><div class="line">    stats auth admin:admin123</div><div class="line">    stats admin if TRUE</div><div class="line"></div><div class="line">frontend api-https</div><div class="line">   mode tcp</div><div class="line">   bind :6443</div><div class="line">   default_backend https-backend</div><div class="line"></div><div class="line">frontend api-http</div><div class="line">   mode tcp</div><div class="line">   bind :8080</div><div class="line">   default_backend http-backend</div><div class="line"></div><div class="line">backend https-backend</div><div class="line">    mode tcp</div><div class="line">    server  api1  192.168.56.11:5443  check</div><div class="line">    server  api2  192.168.56.12:5443  check</div><div class="line">    server  api3  192.168.56.13:5443  check</div><div class="line"></div><div class="line">backend http-backend</div><div class="line">    mode tcp</div><div class="line">    server  api1  192.168.56.11:7070  check</div><div class="line">    server  api2  192.168.56.12:7070  check</div><div class="line">    server  api3  192.168.56.13:7070  check</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="keepalived-配置"><a href="#keepalived-配置" class="headerlink" title="keepalived 配置"></a>keepalived 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /etc/kubernetes/manifests/keepalived.yml &lt;&lt;EOF</div><div class="line">kind: Pod</div><div class="line">apiVersion: v1</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    scheduler.alpha.kubernetes.io/critical-pod: &quot;&quot;</div><div class="line">  labels:</div><div class="line">    component: keepalived</div><div class="line">    tier: control-plane</div><div class="line">  name: keepalived</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  hostNetwork: true</div><div class="line">  containers:</div><div class="line">  - name: keepalived</div><div class="line">    image: kairen/keepalived:1.2.24</div><div class="line">    env:</div><div class="line">    - name: VIRTUAL_IP</div><div class="line">      value: 192.168.56.10</div><div class="line">    - name: INTERFACE</div><div class="line">      value: eth1</div><div class="line">    - name: VIRTUAL_MASK</div><div class="line">      value: &quot;24&quot;</div><div class="line">    - name: CHECK_IP</div><div class="line">      value: any</div><div class="line">    - name: CHECK_PORT</div><div class="line">      value: &quot;2379&quot;</div><div class="line">    - name: VRID</div><div class="line">      value: &quot;53&quot;</div><div class="line">    resources:</div><div class="line">      requests:</div><div class="line">        cpu: 100m</div><div class="line">    securityContext:</div><div class="line">      privileged: true</div><div class="line">      capabilities:</div><div class="line">        add:</div><div class="line">        - NET_ADMIN</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="kubelet-service-配置"><a href="#kubelet-service-配置" class="headerlink" title="kubelet.service 配置"></a>kubelet.service 配置</h4><p>安装 cni 网络 插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /opt/cni/bin &amp;&amp; cd /opt/cni/bin</div><div class="line">$ export CNI_URL=&quot;https://github.com/containernetworking/plugins/releases/download&quot;</div><div class="line">$ wget -qO- &quot;$&#123;CNI_URL&#125;/v0.6.0/cni-plugins-amd64-v0.6.0.tgz&quot; | tar -zx</div></pre></td></tr></table></figure>
<p>kubelet.service：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt;EOF</div><div class="line">[Unit]</div><div class="line">Description=Kubernetes Kubelet</div><div class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</div><div class="line">After=docker.service</div><div class="line">Requires=docker.service</div><div class="line"></div><div class="line">[Service]</div><div class="line">Environment=&quot;KUBELET_KUBECONFIG_ARGS=--kubeconfig=/etc/kubernetes/kubelet.conf&quot;</div><div class="line">Environment=&quot;KUBELET_SYSTEM_PODS_ARGS=--pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true&quot;</div><div class="line">Environment=&quot;KUBELET_NETWORK_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin&quot;</div><div class="line">Environment=&quot;KUBELET_DNS_ARGS=--cluster-dns=10.254.0.2 --cluster-domain=cluster.local&quot;</div><div class="line">Environment=&quot;KUBELET_AUTHZ_ARGS=--authorization-mode=Webhook --client-ca-file=/etc/kubernetes/ssl/ca.pem&quot;</div><div class="line">Environment=&quot;KUBELET_CADVISOR_ARGS=--cadvisor-port=0&quot;</div><div class="line">Environment=&quot;KUBELET_CERTIFICATE_ARGS=--rotate-certificates=true --cert-dir=/var/lib/kubelet/ssl&quot;</div><div class="line">Environment=&quot;KUBELET_EXTRA_ARGS=--node-labels=node-role.kubernetes.io/master=&apos;&apos; --logtostderr=true --v=0 --fail-swap-on=false --cgroup-driver=systemd&quot;</div><div class="line">ExecStart=/usr/local/bin/kubelet \$KUBELET_KUBECONFIG_ARGS \$KUBELET_SYSTEM_PODS_ARGS \$KUBELET_NETWORK_ARGS \$KUBELET_DNS_ARGS \$KUBELET_AUTHZ_ARGS \$KUBELET_CADVISOR_ARGS \$KUBELET_CERTIFICATE_ARGS \$KUBELET_EXTRA_ARGS</div><div class="line">Restart=on-failure</div><div class="line">RestartSec=5</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h3 id="启动-kubelet"><a href="#启动-kubelet" class="headerlink" title="启动 kubelet"></a>启动 kubelet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /var/lib/kubelet /var/log/kubernetes /var/lib/etcd</div><div class="line"></div><div class="line">$ systemctl enable kubelet.service &amp;&amp; systemctl start kubelet.service</div></pre></td></tr></table></figure>
<h3 id="验证集群"><a href="#验证集群" class="headerlink" title="验证集群"></a>验证集群</h3><p>完成后，在任意一台master节点复制 admin kubeconfig 文件，并通过简单指令验证：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cp /etc/kubernetes/admin.conf ~/.kube/config</div><div class="line"></div><div class="line">$ kubectl get cs</div><div class="line">NAME                 STATUS    MESSAGE              ERROR</div><div class="line">controller-manager   Healthy   ok</div><div class="line">scheduler            Healthy   ok</div><div class="line">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;</div><div class="line">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;</div><div class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;</div><div class="line"></div><div class="line">$ kubectl get node</div><div class="line">NAME      STATUS     ROLES     AGE       VERSION</div><div class="line">kube-m1    NotReady   master    52s       v1.10.3</div><div class="line">kube-m2    NotReady   master    51s       v1.10.3</div><div class="line">kube-m3    NotReady   master    50s       v1.10.3</div></pre></td></tr></table></figure>
<p>接着确认服务能够执行 logs 等指令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ kubectl -n kube-system logs -f kube-scheduler-kube-m1</div><div class="line">Error from server (Forbidden): Forbidden (user=kubernetes, verb=get, resource=nodes, subresource=proxy) ( pods/log kube-scheduler-kube-m1)</div></pre></td></tr></table></figure>
<p>这边会发现出现 403 Forbidden 问题，这是因为 kube-apiserver user 并没有 nodes 的资源存取权限，属于正常。</p>
<p>由于上述权限问题，必需建立一个apiserver-to-kubelet-rbac.yml来定义权限，以供对 Nodes 容器执行 logs、exec 等指令。在任意一台master节点执行以下指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; apiserver-to-kubelet-rbac.yml &lt;&lt;EOF</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">kind: ClusterRole</div><div class="line">metadata:</div><div class="line">  annotations:</div><div class="line">    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;</div><div class="line">  labels:</div><div class="line">    kubernetes.io/bootstrapping: rbac-defaults</div><div class="line">  name: system:kube-apiserver-to-kubelet</div><div class="line">rules:</div><div class="line">  - apiGroups:</div><div class="line">      - &quot;&quot;</div><div class="line">    resources:</div><div class="line">      - nodes/proxy</div><div class="line">      - nodes/stats</div><div class="line">      - nodes/log</div><div class="line">      - nodes/spec</div><div class="line">      - nodes/metrics</div><div class="line">    verbs:</div><div class="line">      - &quot;*&quot;</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: system:kube-apiserver</div><div class="line">  namespace: &quot;&quot;</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:kube-apiserver-to-kubelet</div><div class="line">subjects:</div><div class="line">  - apiGroup: rbac.authorization.k8s.io</div><div class="line">    kind: User</div><div class="line">    name: kube-apiserver</div><div class="line">EOF</div><div class="line"></div><div class="line">$ kubectl apply -f apiserver-to-kubelet-rbac.yml</div><div class="line">clusterrole.rbac.authorization.k8s.io &quot;system:kube-apiserver-to-kubelet&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;system:kube-apiserver&quot; created</div><div class="line"></div><div class="line">$ # 测试 logs</div><div class="line">$ kubectl -n kube-system logs -f kube-scheduler-kube-m1</div></pre></td></tr></table></figure>
<p>设定master节点允许 Taint：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ kubectl taint nodes node-role.kubernetes.io/master=&quot;&quot;:NoSchedule --all</div><div class="line">node &quot;kube-m1&quot; tainted</div><div class="line">node &quot;kube-m2&quot; tainted</div><div class="line">node &quot;kube-m3&quot; tainted</div></pre></td></tr></table></figure></p>
<h3 id="建立-TLS-Bootstrapping-RBAC-与-Secret"><a href="#建立-TLS-Bootstrapping-RBAC-与-Secret" class="headerlink" title="建立 TLS Bootstrapping RBAC 与 Secret"></a>建立 TLS Bootstrapping RBAC 与 Secret</h3><p>由于本次安装启用了 TLS 认证，因此每个节点的 kubelet 都必须使用 kube-apiserver 的 CA 的凭证后，才能与 kube-apiserver 进行沟通，而该过程需要手动针对每台节点单独签署凭证是一件繁琐的事情，且一旦节点增加会延伸出管理不易问题; 而 TLS bootstrapping 目标就是解决该问题，通过让 kubelet 先使用一个预定低权限使用者连接到 kube-apiserver，然后在对 kube-apiserver 申请凭证签署，当授权 Token 一致时，Node 节点的 kubelet 凭证将由 kube-apiserver 动态签署提供。具体作法可以参考 TLS Bootstrapping 与 Authenticating with Bootstrap Tokens。</p>
<p>首先在 kube-m1 建立一个变量来产生BOOTSTRAP_TOKEN，并建立bootstrap-kubelet.conf的 Kubernetes config 档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cd /etc/kubernetes/ssl</div><div class="line">$ export TOKEN_ID=$(openssl rand 3 -hex)</div><div class="line">$ export TOKEN_SECRET=$(openssl rand 8 -hex)</div><div class="line">$ export BOOTSTRAP_TOKEN=$&#123;TOKEN_ID&#125;.$&#123;TOKEN_SECRET&#125;</div><div class="line">$ export KUBE_APISERVER=&quot;https://192.168.56.10:6443&quot;</div><div class="line">$ # 设置集群参数</div><div class="line">$ kubectl config set-cluster kubernetes \</div><div class="line">    --certificate-authority=ca.pem \</div><div class="line">    --embed-certs=true \</div><div class="line">    --server=$&#123;KUBE_APISERVER&#125; \</div><div class="line">    --kubeconfig=../bootstrap-kubelet.conf</div><div class="line">$ # 设置客户端认证参数</div><div class="line">$ kubectl config set-credentials tls-bootstrap-token-user \</div><div class="line">    --token=$&#123;BOOTSTRAP_TOKEN&#125; \</div><div class="line">    --kubeconfig=../bootstrap-kubelet.conf</div><div class="line">$ # 设置上下文参数</div><div class="line">$ kubectl config set-context tls-bootstrap-token-user@kubernetes \</div><div class="line">    --cluster=kubernetes \</div><div class="line">    --user=tls-bootstrap-token-user \</div><div class="line">    --kubeconfig=../bootstrap-kubelet.conf</div><div class="line">$ # 设置默认上下文</div><div class="line">$ kubectl config use-context tls-bootstrap-token-user@kubernetes \</div><div class="line">    --kubeconfig=../bootstrap-kubelet.conf</div></pre></td></tr></table></figure>
<p>接着在 kube-m1 建立 TLS bootstrap secret 来提供自动签证使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">$ cat &lt;&lt;EOF | kubectl create -f -</div><div class="line">apiVersion: v1</div><div class="line">kind: Secret</div><div class="line">metadata:</div><div class="line">  name: bootstrap-token-$&#123;TOKEN_ID&#125;</div><div class="line">  namespace: kube-system</div><div class="line">type: bootstrap.kubernetes.io/token</div><div class="line">stringData:</div><div class="line">  token-id: $&#123;TOKEN_ID&#125;</div><div class="line">  token-secret: $&#123;TOKEN_SECRET&#125;</div><div class="line">  usage-bootstrap-authentication: &quot;true&quot;</div><div class="line">  usage-bootstrap-signing: &quot;true&quot;</div><div class="line">  auth-extra-groups: system:bootstrappers:default-node-token</div><div class="line">EOF</div><div class="line">secret &quot;bootstrap-token-ea4387&quot; created</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">$ # 在 kube-m1 建立 TLS Bootstrap Autoapprove RBAC：</div><div class="line"></div><div class="line">$ cat &lt;&lt;EOF | kubectl create -f -</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: kubelet-bootstrap</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:node-bootstrapper</div><div class="line">subjects:</div><div class="line">- apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: Group</div><div class="line">  name: system:bootstrappers:default-node-token</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: node-autoapprove-bootstrap</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient</div><div class="line">subjects:</div><div class="line">- apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: Group</div><div class="line">  name: system:bootstrappers:default-node-token</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: node-autoapprove-certificate-rotation</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient</div><div class="line">subjects:</div><div class="line">- apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: Group</div><div class="line">  name: system:nodes</div><div class="line">EOF</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;kubelet-bootstrap&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;node-autoapprove-bootstrap&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;node-autoapprove-certificate-rotation&quot; created</div></pre></td></tr></table></figure>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#部署-Master"><span class="toc-number">1.</span> <span class="toc-text">部署 Master</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署和设定"><span class="toc-number">1.1.</span> <span class="toc-text">部署和设定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-apiserver-配置"><span class="toc-number">1.1.1.</span> <span class="toc-text">kube-apiserver 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-controller-manager-配置"><span class="toc-number">1.1.2.</span> <span class="toc-text">kube-controller-manager 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-scheduler-配置"><span class="toc-number">1.1.3.</span> <span class="toc-text">kube-scheduler 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#etcd-配置"><span class="toc-number">1.1.4.</span> <span class="toc-text">etcd 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#haproxy-配置"><span class="toc-number">1.1.5.</span> <span class="toc-text">haproxy 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keepalived-配置"><span class="toc-number">1.1.6.</span> <span class="toc-text">keepalived 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kubelet-service-配置"><span class="toc-number">1.1.7.</span> <span class="toc-text">kubelet.service 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动-kubelet"><span class="toc-number">1.2.</span> <span class="toc-text">启动 kubelet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证集群"><span class="toc-number">1.3.</span> <span class="toc-text">验证集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立-TLS-Bootstrapping-RBAC-与-Secret"><span class="toc-number">1.4.</span> <span class="toc-text">建立 TLS Bootstrapping RBAC 与 Secret</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&text=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&is_video=false&description=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master&body=Check out this article: xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/&name=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 萧非瑟 <a href="http://www.miitbeian.gov.cn">粤ICP备17119417号-1</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->



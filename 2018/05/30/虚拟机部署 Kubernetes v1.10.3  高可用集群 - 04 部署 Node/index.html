<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="部署 Node在开始部署前，先在 kube-m1 将需要用到的文件复制到所有 node 节点上： 123456789101112131415$ cd /etc/kubernetes/ssl$ for NODE in kube-n1 kube-n2 kube-n3; do    echo &amp;quot;--- $NODE ---&amp;quot;    ssh $&amp;#123;NODE&amp;#125; &amp;quot">
<meta property="og:type" content="article">
<meta property="og:title" content="虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node">
<meta property="og:url" content="xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/index.html">
<meta property="og:site_name" content="萧非瑟">
<meta property="og:description" content="部署 Node在开始部署前，先在 kube-m1 将需要用到的文件复制到所有 node 节点上： 123456789101112131415$ cd /etc/kubernetes/ssl$ for NODE in kube-n1 kube-n2 kube-n3; do    echo &amp;quot;--- $NODE ---&amp;quot;    ssh $&amp;#123;NODE&amp;#125; &amp;quot">
<meta property="og:updated_time" content="2018-08-20T10:12:03.591Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node">
<meta name="twitter:description" content="部署 Node在开始部署前，先在 kube-m1 将需要用到的文件复制到所有 node 节点上： 123456789101112131415$ cd /etc/kubernetes/ssl$ for NODE in kube-n1 kube-n2 kube-n3; do    echo &amp;quot;--- $NODE ---&amp;quot;    ssh $&amp;#123;NODE&amp;#125; &amp;quot">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 05 总结/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 03 部署 Master/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#部署-Node"><span class="toc-number">1.</span> <span class="toc-text">部署 Node</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署与设定"><span class="toc-number">1.1.</span> <span class="toc-text">部署与设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证集群"><span class="toc-number">1.2.</span> <span class="toc-text">验证集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-Core-Addons-部署"><span class="toc-number">1.3.</span> <span class="toc-text">Kubernetes Core Addons 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes-Proxy"><span class="toc-number">1.3.1.</span> <span class="toc-text">Kubernetes Proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes-DNS"><span class="toc-number">1.3.2.</span> <span class="toc-text">Kubernetes DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Calico-Network-安装与设定"><span class="toc-number">1.3.3.</span> <span class="toc-text">Calico Network 安装与设定</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">萧非瑟</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-05-30T17:53:39.000Z" itemprop="datePublished">2018-05-30</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="部署-Node"><a href="#部署-Node" class="headerlink" title="部署 Node"></a>部署 Node</h2><p>在开始部署前，先在 kube-m1 将需要用到的文件复制到所有 node 节点上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cd /etc/kubernetes/ssl</div><div class="line"></div><div class="line">$ for NODE in kube-n1 kube-n2 kube-n3; do</div><div class="line">    echo &quot;--- $NODE ---&quot;</div><div class="line">    ssh $&#123;NODE&#125; &quot;mkdir -p /etc/kubernetes/ssl/&quot;</div><div class="line">    ssh $&#123;NODE&#125; &quot;mkdir -p /etc/etcd/ssl&quot;</div><div class="line">    # Etcd</div><div class="line">    for FILE in etcd.pem etcd-key.pem; do</div><div class="line">      scp /etc/etcd/ssl/$&#123;FILE&#125; $&#123;NODE&#125;:/etc/etcd/ssl/$&#123;FILE&#125;</div><div class="line">    done</div><div class="line">    # Kubernetes</div><div class="line">    for FILE in ssl/ca.pem ssl/ca-key.pem bootstrap-kubelet.conf; do</div><div class="line">      scp /etc/kubernetes/$&#123;FILE&#125; $&#123;NODE&#125;:/etc/kubernetes/$&#123;FILE&#125;</div><div class="line">    done</div><div class="line">done</div></pre></td></tr></table></figure>
<h3 id="部署与设定"><a href="#部署与设定" class="headerlink" title="部署与设定"></a>部署与设定</h3><p>以下所有操作需要在每台 Node 节点上都进行一遍。</p>
<p>在每台 node 节点配置 kubelet.service 相关文件来管理 kubelet：</p>
<p>安装 cni 网络 插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /opt/cni/bin &amp;&amp; cd /opt/cni/bin</div><div class="line">$ export CNI_URL=&quot;https://github.com/containernetworking/plugins/releases/download&quot;</div><div class="line">$ wget -qO- &quot;$&#123;CNI_URL&#125;/v0.6.0/cni-plugins-amd64-v0.6.0.tgz&quot; | tar -zx</div></pre></td></tr></table></figure>
<p>配置 kubelet.service：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt;EOF</div><div class="line">[Unit]</div><div class="line">Description=Kubernetes Kubelet</div><div class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</div><div class="line">After=docker.service</div><div class="line">Requires=docker.service</div><div class="line"></div><div class="line">[Service]</div><div class="line">Environment=&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</div><div class="line">Environment=&quot;KUBELET_SYSTEM_PODS_ARGS=--pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true&quot;</div><div class="line">Environment=&quot;KUBELET_NETWORK_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin&quot;</div><div class="line">Environment=&quot;KUBELET_DNS_ARGS=--cluster-dns=10.254.0.2 --cluster-domain=cluster.local&quot;</div><div class="line">Environment=&quot;KUBELET_AUTHZ_ARGS=--authorization-mode=Webhook --client-ca-file=/etc/kubernetes/ssl/ca.pem&quot;</div><div class="line">Environment=&quot;KUBELET_CADVISOR_ARGS=--cadvisor-port=0&quot;</div><div class="line">Environment=&quot;KUBELET_CERTIFICATE_ARGS=--rotate-certificates=true --cert-dir=/var/lib/kubelet/ssl&quot;</div><div class="line">Environment=&quot;KUBELET_EXTRA_ARGS=--node-labels=node-role.kubernetes.io/node=&apos;&apos; --logtostderr=true --v=0 --fail-swap-on=false --cgroup-driver=systemd&quot;</div><div class="line">ExecStart=/usr/local/bin//kubelet \$KUBELET_KUBECONFIG_ARGS \$KUBELET_SYSTEM_PODS_ARGS \$KUBELET_NETWORK_ARGS \$KUBELET_DNS_ARGS \$KUBELET_AUTHZ_ARGS \$KUBELET_CADVISOR_ARGS \$KUBELET_CERTIFICATE_ARGS \$KUBELET_EXTRA_ARGS</div><div class="line">Restart=on-failure</div><div class="line">RestartSec=5</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>最后建立 var 存放信息，然后启动 kubelet 服务:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /var/lib/kubelet /var/log/kubernetes</div><div class="line"></div><div class="line">$ systemctl enable kubelet.service &amp;&amp; systemctl start kubelet.service</div></pre></td></tr></table></figure>
<h3 id="验证集群"><a href="#验证集群" class="headerlink" title="验证集群"></a>验证集群</h3><p>在任意 Mater 执行以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ kubectl get csr</div><div class="line">csr-xtvv5                                              1h        system:node:kube-m1       Approved,Issued</div><div class="line">csr-bm696                                              1h        system:node:kube-m2       Approved,Issued</div><div class="line">csr-s95db                                              1h        system:node:kube-m3       Approved,Issued</div><div class="line">node-csr-7EpNHKBXNxc75nKEbT10qweZ5tPNSVYSW9lHhgXP_io   5m        system:bootstrap:c63cdb   Approved,Issued</div><div class="line">node-csr-MLS26OAthEDtOVKcu9UYoA6sldkUEj49MTv278z-w7o   1m        system:bootstrap:c63cdb   Approved,Issued</div><div class="line">node-csr-rJUWN98SoxqdtTcfToALKB7Whj55wl4WPGcGxLQBIHo   1m        system:bootstrap:c63cdb   Approved,Issued</div><div class="line"></div><div class="line">$ kubectl get nodes</div><div class="line">kube-m1   NotReady   master    1h        v1.10.3</div><div class="line">kube-m2   NotReady   master    1h        v1.10.3</div><div class="line">kube-m3   NotReady   master    1h        v1.10.3</div><div class="line">kube-n1   NotReady   node      7m        v1.10.3</div><div class="line">kube-n2   NotReady   node      2m        v1.10.3</div><div class="line">kube-n3   NotReady   node      2m        v1.10.3</div></pre></td></tr></table></figure></p>
<h3 id="Kubernetes-Core-Addons-部署"><a href="#Kubernetes-Core-Addons-部署" class="headerlink" title="Kubernetes Core Addons 部署"></a>Kubernetes Core Addons 部署</h3><p>当完成上面所有步骤后，接着需要部署一些插件，如 Kubernetes DNS 与 Kubernetes Proxy 等。</p>
<h4 id="Kubernetes-Proxy"><a href="#Kubernetes-Proxy" class="headerlink" title="Kubernetes Proxy"></a>Kubernetes Proxy</h4><p>Kube-proxy 是实现 Service 的关键插件，kube-proxy 会在每台节点上执行，然后监听 API Server 的 Service 与 Endpoint 资源物件的改变，然后来依据变化执行 iptables 来实现网络的转发。这边我们会需要建议一个 DaemonSet 来执行，并且建立一些需要的 Certificates。</p>
<p>在 kube-m1 配置 kube-proxy.yml 来安装 Kubernetes Proxy 插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div></pre></td><td class="code"><pre><div class="line">$ mkdir /etc/kubernetes/addon &amp;&amp; cd /etc/kubernetes/addon</div><div class="line">$ cat &gt; /etc/kubernetes/addon/kube-proxy.yml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line">  name: kube-proxy</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    addonmanager.kubernetes.io/mode: Reconcile</div><div class="line">---</div><div class="line">kind: ClusterRoleBinding</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line">  name: system:kube-proxy</div><div class="line">  labels:</div><div class="line">    addonmanager.kubernetes.io/mode: Reconcile</div><div class="line">subjects:</div><div class="line">  - kind: ServiceAccount</div><div class="line">    name: kube-proxy</div><div class="line">    namespace: kube-system</div><div class="line">roleRef:</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:node-proxier</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: ConfigMap</div><div class="line">metadata:</div><div class="line">  labels:</div><div class="line">    app: kube-proxy</div><div class="line">  name: kube-proxy</div><div class="line">  namespace: kube-system</div><div class="line">data:</div><div class="line">  config.conf: |-</div><div class="line">    apiVersion: kubeproxy.config.k8s.io/v1alpha1</div><div class="line">    bindAddress: 0.0.0.0</div><div class="line">    clientConnection:</div><div class="line">      acceptContentTypes: &quot;&quot;</div><div class="line">      burst: 10</div><div class="line">      contentType: application/vnd.kubernetes.protobuf</div><div class="line">      kubeconfig: /var/lib/kube-proxy/kubeconfig.conf</div><div class="line">      qps: 5</div><div class="line">    clusterCIDR: 172.30.0.0/16</div><div class="line">    configSyncPeriod: 15m0s</div><div class="line">    conntrack:</div><div class="line">      max: null</div><div class="line">      maxPerCore: 32768</div><div class="line">      min: 131072</div><div class="line">      tcpCloseWaitTimeout: 1h0m0s</div><div class="line">      tcpEstablishedTimeout: 24h0m0s</div><div class="line">    enableProfiling: false</div><div class="line">    healthzBindAddress: 0.0.0.0:10256</div><div class="line">    hostnameOverride: &quot;&quot;</div><div class="line">    iptables:</div><div class="line">      masqueradeAll: false</div><div class="line">      masqueradeBit: 14</div><div class="line">      minSyncPeriod: 0s</div><div class="line">      syncPeriod: 30s</div><div class="line">    ipvs:</div><div class="line">      minSyncPeriod: 0s</div><div class="line">      scheduler: &quot;&quot;</div><div class="line">      syncPeriod: 30s</div><div class="line">    kind: KubeProxyConfiguration</div><div class="line">    metricsBindAddress: 127.0.0.1:10249</div><div class="line">    mode: &quot;&quot;</div><div class="line">    nodePortAddresses: null</div><div class="line">    oomScoreAdj: -999</div><div class="line">    portRange: &quot;&quot;</div><div class="line">    resourceContainer: /kube-proxy</div><div class="line">    udpIdleTimeout: 250ms</div><div class="line">  kubeconfig.conf: |-</div><div class="line">    apiVersion: v1</div><div class="line">    kind: Config</div><div class="line">    clusters:</div><div class="line">    - cluster:</div><div class="line">        certificate-authority: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</div><div class="line">        server: https://192.168.56.10:6443</div><div class="line">      name: default</div><div class="line">    contexts:</div><div class="line">    - context:</div><div class="line">        cluster: default</div><div class="line">        namespace: default</div><div class="line">        user: default</div><div class="line">      name: default</div><div class="line">    current-context: default</div><div class="line">    users:</div><div class="line">    - name: default</div><div class="line">      user:</div><div class="line">        tokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token</div><div class="line">---</div><div class="line">apiVersion: apps/v1</div><div class="line">kind: DaemonSet</div><div class="line">metadata:</div><div class="line">  labels:</div><div class="line">    k8s-app: kube-proxy</div><div class="line">  name: kube-proxy</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  selector:</div><div class="line">    matchLabels:</div><div class="line">      k8s-app: kube-proxy</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        k8s-app: kube-proxy</div><div class="line">    spec:</div><div class="line">      tolerations:</div><div class="line">      - effect: NoSchedule</div><div class="line">        key: node-role.kubernetes.io/master</div><div class="line">      - effect: NoSchedule</div><div class="line">        key: node.cloudprovider.kubernetes.io/uninitialized</div><div class="line">        value: &quot;true&quot;</div><div class="line">      hostNetwork: true</div><div class="line">      restartPolicy: Always</div><div class="line">      serviceAccount: kube-proxy</div><div class="line">      serviceAccountName: kube-proxy</div><div class="line">      containers:</div><div class="line">      - name: kube-proxy</div><div class="line">        image: k8s.gcr.io/kube-proxy-amd64:v1.10.3</div><div class="line">        command:</div><div class="line">        - /usr/local/bin/kube-proxy</div><div class="line">        - --config=/var/lib/kube-proxy/config.conf</div><div class="line">        imagePullPolicy: IfNotPresent</div><div class="line">        securityContext:</div><div class="line">          privileged: true</div><div class="line">        volumeMounts:</div><div class="line">        - mountPath: /var/lib/kube-proxy</div><div class="line">          name: kube-proxy</div><div class="line">        - mountPath: /run/xtables.lock</div><div class="line">          name: xtables-lock</div><div class="line">        - mountPath: /lib/modules</div><div class="line">          name: lib-modules</div><div class="line">          readOnly: true</div><div class="line">      volumes:</div><div class="line">      - configMap:</div><div class="line">          defaultMode: 420</div><div class="line">          name: kube-proxy</div><div class="line">        name: kube-proxy</div><div class="line">      - hostPath:</div><div class="line">          path: /run/xtables.lock</div><div class="line">          type: FileOrCreate</div><div class="line">        name: xtables-lock</div><div class="line">      - hostPath:</div><div class="line">          path: /lib/modules</div><div class="line">        name: lib-modules</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>安装插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ kubectl create -f /etc/kubernetes/addon/kube-proxy.yml</div><div class="line">serviceaccount &quot;kube-proxy&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;system:kube-proxy&quot; created</div><div class="line">configmap &quot;kube-proxy&quot; created</div><div class="line">daemonset.apps &quot;kube-proxy&quot; created</div><div class="line"></div><div class="line">$ kubectl -n kube-system get po -o wide -l k8s-app=kube-proxy</div><div class="line">kube-proxy-42f4m   1/1       Running   0          47s       192.168.56.15   kube-n2</div><div class="line">kube-proxy-5zn95   1/1       Running   0          48s       192.168.56.14   kube-n1</div><div class="line">kube-proxy-7mwrf   1/1       Running   0          48s       192.168.56.11   kube-m1</div><div class="line">kube-proxy-bs5p2   1/1       Running   0          47s       192.168.56.16   kube-n3</div><div class="line">kube-proxy-qzsrx   1/1       Running   0          47s       192.168.56.13   kube-m3</div><div class="line">kube-proxy-sgxvh   1/1       Running   0          47s       192.168.56.12   kube-m2</div></pre></td></tr></table></figure>
<h4 id="Kubernetes-DNS"><a href="#Kubernetes-DNS" class="headerlink" title="Kubernetes DNS"></a>Kubernetes DNS</h4><p>Kubernetes DNS 是 Kubernetes 集群内部 Pod 之间互相沟通的重要插件，它允许 Pod 可以通过 Domain Name 方式来连接 Service，其主要由 Kube DNS 与 Sky DNS 组合而成，通过 Kube DNS 监听 Service 与 Endpoint 变化，来提供给 Sky DNS 信息，已更新解析位址。</p>
<p>在 kube-m1 配置 kube-dns.yml 来安装 Kubernetes DNS 插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div></pre></td><td class="code"><pre><div class="line">$ cd /etc/kubernetes/addon</div><div class="line">$ cat &gt; /etc/kubernetes/addon/kube-dns.yml &lt;&lt;EOF</div><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line">  name: kube-dns</div><div class="line">  labels:</div><div class="line">    k8s-app: kube-dns</div><div class="line">    kubernetes.io/cluster-service: &quot;true&quot;</div><div class="line">    addonmanager.kubernetes.io/mode: Reconcile</div><div class="line">  namespace: kube-system</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: kube-dns</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    k8s-app: kube-dns</div><div class="line">    kubernetes.io/cluster-service: &quot;true&quot;</div><div class="line">    addonmanager.kubernetes.io/mode: Reconcile</div><div class="line">spec:</div><div class="line">  selector:</div><div class="line">    k8s-app: kube-dns</div><div class="line">  clusterIP: 10.254.0.2</div><div class="line">  ports:</div><div class="line">  - name: dns</div><div class="line">    port: 53</div><div class="line">    protocol: UDP</div><div class="line">  - name: dns-tcp</div><div class="line">    port: 53</div><div class="line">    protocol: TCP</div><div class="line">---</div><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: kube-dns</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    k8s-app: kube-dns</div><div class="line">    kubernetes.io/cluster-service: &quot;true&quot;</div><div class="line">    addonmanager.kubernetes.io/mode: Reconcile</div><div class="line">spec:</div><div class="line">  selector:</div><div class="line">    matchLabels:</div><div class="line">      k8s-app: kube-dns</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        k8s-app: kube-dns</div><div class="line">      annotations:</div><div class="line">        scheduler.alpha.kubernetes.io/critical-pod: &apos;&apos;</div><div class="line">    spec:</div><div class="line">      dnsPolicy: Default</div><div class="line">      serviceAccountName: kube-dns</div><div class="line">      tolerations:</div><div class="line">      - key: &quot;CriticalAddonsOnly&quot;</div><div class="line">        operator: &quot;Exists&quot;</div><div class="line">      - key: node-role.kubernetes.io/master</div><div class="line">        effect: NoSchedule</div><div class="line">      volumes:</div><div class="line">      - name: kube-dns-config</div><div class="line">        configMap:</div><div class="line">          name: kube-dns</div><div class="line">          optional: true</div><div class="line">      containers:</div><div class="line">      - name: kubedns</div><div class="line">        image: gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.7</div><div class="line">        resources:</div><div class="line">          limits:</div><div class="line">            memory: 170Mi</div><div class="line">          requests:</div><div class="line">            cpu: 100m</div><div class="line">            memory: 70Mi</div><div class="line">        livenessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /healthcheck/kubedns</div><div class="line">            port: 10054</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 60</div><div class="line">          timeoutSeconds: 5</div><div class="line">          successThreshold: 1</div><div class="line">          failureThreshold: 5</div><div class="line">        readinessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /readiness</div><div class="line">            port: 8081</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 3</div><div class="line">          timeoutSeconds: 5</div><div class="line">        args:</div><div class="line">        - &quot;--domain=cluster.local&quot;</div><div class="line">        - --dns-port=10053</div><div class="line">        - --v=2</div><div class="line">        env:</div><div class="line">        - name: PROMETHEUS_PORT</div><div class="line">          value: &quot;10055&quot;</div><div class="line">        ports:</div><div class="line">        - containerPort: 10053</div><div class="line">          name: dns-local</div><div class="line">          protocol: UDP</div><div class="line">        - containerPort: 10053</div><div class="line">          name: dns-tcp-local</div><div class="line">          protocol: TCP</div><div class="line">        - containerPort: 10055</div><div class="line">          name: metrics</div><div class="line">          protocol: TCP</div><div class="line">        volumeMounts:</div><div class="line">        - name: kube-dns-config</div><div class="line">          mountPath: /kube-dns-config</div><div class="line">      - name: dnsmasq</div><div class="line">        image: gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.7</div><div class="line">        livenessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /healthcheck/dnsmasq</div><div class="line">            port: 10054</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 60</div><div class="line">          timeoutSeconds: 5</div><div class="line">          successThreshold: 1</div><div class="line">          failureThreshold: 5</div><div class="line">        args:</div><div class="line">        - &quot;-v=2&quot;</div><div class="line">        - &quot;-logtostderr&quot;</div><div class="line">        - &quot;-configDir=/etc/k8s/dns/dnsmasq-nanny&quot;</div><div class="line">        - &quot;-restartDnsmasq=true&quot;</div><div class="line">        - &quot;--&quot;</div><div class="line">        - &quot;-k&quot;</div><div class="line">        - &quot;--cache-size=1000&quot;</div><div class="line">        - &quot;--log-facility=-&quot;</div><div class="line">        - &quot;--server=/cluster.local/127.0.0.1#10053&quot;</div><div class="line">        - &quot;--server=/in-addr.arpa/127.0.0.1#10053&quot;</div><div class="line">        - &quot;--server=/ip6.arpa/127.0.0.1#10053&quot;</div><div class="line">        ports:</div><div class="line">        - containerPort: 53</div><div class="line">          name: dns</div><div class="line">          protocol: UDP</div><div class="line">        - containerPort: 53</div><div class="line">          name: dns-tcp</div><div class="line">          protocol: TCP</div><div class="line">        resources:</div><div class="line">          requests:</div><div class="line">            cpu: 150m</div><div class="line">            memory: 20Mi</div><div class="line">        volumeMounts:</div><div class="line">        - name: kube-dns-config</div><div class="line">          mountPath: /etc/k8s/dns/dnsmasq-nanny</div><div class="line">      - name: sidecar</div><div class="line">        image: gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.7</div><div class="line">        livenessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /metrics</div><div class="line">            port: 10054</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 60</div><div class="line">          timeoutSeconds: 5</div><div class="line">          successThreshold: 1</div><div class="line">          failureThreshold: 5</div><div class="line">        args:</div><div class="line">        - &quot;--v=2&quot;</div><div class="line">        - &quot;--logtostderr&quot;</div><div class="line">        - &quot;--probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,A&quot;</div><div class="line">        - &quot;--probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,A&quot;</div><div class="line">        ports:</div><div class="line">        - containerPort: 10054</div><div class="line">          name: metrics</div><div class="line">          protocol: TCP</div><div class="line">        resources:</div><div class="line">          requests:</div><div class="line">            memory: 20Mi</div><div class="line">            cpu: 10m</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ul>
<li>其中 <code>10.254.0.2</code> 为 kubelet.service 中配置的 <code>--cluster-dns</code>。</li>
</ul>
<p>安装插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kubectl create -f /etc/kubernetes/addon/kube-dns.yml</div><div class="line">serviceaccount &quot;kube-dns&quot; created</div><div class="line">service &quot;kube-dns&quot; created</div><div class="line">deployment.extensions &quot;kube-dns&quot; created</div><div class="line"></div><div class="line">$ kubectl -n kube-system get po -l k8s-app=kube-dns</div><div class="line">NAME                        READY     STATUS    RESTARTS   AGE</div><div class="line">kube-dns-654684d656-vzkjk   0/3       Pending   0          19s</div></pre></td></tr></table></figure>
<p>这边会发现处于 <code>Pending</code> 状态，这是由于 Kubernetes Pod Network 还未建立完成，因此所有节点会处于 NotReady 状态，而造成 Pod 无法被排程分配到指定节点上启动，下面安装 Pod Network。</p>
<h4 id="Calico-Network-安装与设定"><a href="#Calico-Network-安装与设定" class="headerlink" title="Calico Network 安装与设定"></a>Calico Network 安装与设定</h4><p>Calico 是一款纯 Layer 3 的资料中心网络方案(不需要 Overlay 网络)，Calico 好处是它整合了各种云原生平台，且 Calico 在每一个节点利用 Linux Kernel 实现高效的 vRouter 来负责资料的转发，而当资料中心复杂度增加时，可以用 BGP route reflector 来达成。</p>
<p>本次不采用手动方式来建立 Calico 网络，若想了解可以参考 <a href="https://docs.projectcalico.org/v3.0/getting-started/kubernetes/installation/integration" target="_blank" rel="external">Integration Guide</a>。</p>
<p>在 kube-m1 配置 calico.yaml 来安装 Calico Network：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div></pre></td><td class="code"><pre><div class="line">$ mkdir /etc/kubernetes/network &amp;&amp; cd /etc/kubernetes/network</div><div class="line">$ cat &gt; /etc/kubernetes/network/calico.yml &lt;&lt;EOF</div><div class="line">kind: ConfigMap</div><div class="line">apiVersion: v1</div><div class="line">metadata:</div><div class="line">  name: calico-config</div><div class="line">  namespace: kube-system</div><div class="line">data:</div><div class="line">  etcd_endpoints: &quot;https://192.168.56.11:2379,https://192.168.56.12:2379,https://192.168.56.13:2379&quot;</div><div class="line">  calico_backend: &quot;bird&quot;</div><div class="line">  cni_network_config: |-</div><div class="line">    &#123;</div><div class="line">      &quot;name&quot;: &quot;k8s-pod-network&quot;,</div><div class="line">      &quot;cniVersion&quot;: &quot;0.3.0&quot;,</div><div class="line">      &quot;plugins&quot;: [</div><div class="line">        &#123;</div><div class="line">          &quot;type&quot;: &quot;calico&quot;,</div><div class="line">          &quot;etcd_endpoints&quot;: &quot;__ETCD_ENDPOINTS__&quot;,</div><div class="line">          &quot;etcd_ca_cert_file&quot;: &quot;/etc/kubernetes/ssl/ca.pem&quot;,</div><div class="line">          &quot;etcd_cert_file&quot;: &quot;/etc/etcd/ssl/etcd.pem&quot;,</div><div class="line">          &quot;etcd_key_file&quot;: &quot;/etc/etcd/ssl/etcd-key.pem&quot;,</div><div class="line">          &quot;log_level&quot;: &quot;info&quot;,</div><div class="line">          &quot;mtu&quot;: 1500,</div><div class="line">          &quot;ipam&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;calico-ipam&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;policy&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;k8s&quot;,</div><div class="line">               &quot;k8s_api_root&quot;: &quot;https://__KUBERNETES_SERVICE_HOST__:__KUBERNETES_SERVICE_PORT__&quot;,</div><div class="line">               &quot;k8s_auth_token&quot;: &quot;__SERVICEACCOUNT_TOKEN__&quot;</div><div class="line">          &#125;,</div><div class="line">          &quot;kubernetes&quot;: &#123;</div><div class="line">              &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/__KUBECONFIG_FILENAME__&quot;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          &quot;type&quot;: &quot;portmap&quot;,</div><div class="line">          &quot;snat&quot;: true,</div><div class="line">          &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">---</div><div class="line">kind: DaemonSet</div><div class="line">apiVersion: extensions/v1beta1</div><div class="line">metadata:</div><div class="line">  name: calico-node</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    k8s-app: calico-node</div><div class="line">spec:</div><div class="line">  selector:</div><div class="line">    matchLabels:</div><div class="line">      k8s-app: calico-node</div><div class="line">  updateStrategy:</div><div class="line">    type: RollingUpdate</div><div class="line">    rollingUpdate:</div><div class="line">      maxUnavailable: 1</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        k8s-app: calico-node</div><div class="line">      annotations:</div><div class="line">        scheduler.alpha.kubernetes.io/critical-pod: &apos;&apos;</div><div class="line">    spec:</div><div class="line">      hostNetwork: true</div><div class="line">      tolerations:</div><div class="line">      - key: node.cloudprovider.kubernetes.io/uninitialized</div><div class="line">        value: &quot;true&quot;</div><div class="line">        effect: NoSchedule</div><div class="line">      - key: node-role.kubernetes.io/master</div><div class="line">        effect: NoSchedule</div><div class="line">      - key: CriticalAddonsOnly</div><div class="line">        operator: Exists</div><div class="line">      serviceAccountName: calico-cni-plugin</div><div class="line">      terminationGracePeriodSeconds: 0</div><div class="line">      containers:</div><div class="line">        - name: calico-node</div><div class="line">          image: quay.io/calico/node:v3.0.4</div><div class="line">          env:</div><div class="line">            - name: CLUSTER_TYPE</div><div class="line">              value: &quot;k8s,bgp&quot;</div><div class="line">            - name: ETCD_ENDPOINTS</div><div class="line">              valueFrom:</div><div class="line">                configMapKeyRef:</div><div class="line">                  name: calico-config</div><div class="line">                  key: etcd_endpoints</div><div class="line">            - name: CALICO_NETWORKING_BACKEND</div><div class="line">              valueFrom:</div><div class="line">                configMapKeyRef:</div><div class="line">                  name: calico-config</div><div class="line">                  key: calico_backend</div><div class="line">            - name: CALICO_DISABLE_FILE_LOGGING</div><div class="line">              value: &quot;true&quot;</div><div class="line">            - name: CALICO_K8S_NODE_REF</div><div class="line">              valueFrom:</div><div class="line">                fieldRef:</div><div class="line">                  fieldPath: spec.nodeName</div><div class="line">            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION</div><div class="line">              value: &quot;ACCEPT&quot;</div><div class="line">            - name: CALICO_IPV4POOL_CIDR</div><div class="line">              value: &quot;10.244.0.0/16&quot;</div><div class="line">            - name: CALICO_IPV4POOL_IPIP</div><div class="line">              value: &quot;Always&quot;</div><div class="line">            - name: FELIX_IPV6SUPPORT</div><div class="line">              value: &quot;false&quot;</div><div class="line">            - name: FELIX_IPINIPMTU</div><div class="line">              value: &quot;1440&quot;</div><div class="line">            - name: FELIX_LOGSEVERITYSCREEN</div><div class="line">              value: &quot;info&quot;</div><div class="line">            - name: IP</div><div class="line">              value: &quot;autodetect&quot;</div><div class="line">            - name: FELIX_HEALTHENABLED</div><div class="line">              value: &quot;true&quot;</div><div class="line">            - name: IP_AUTODETECTION_METHOD</div><div class="line">              value: &quot;interface=eth1&quot;</div><div class="line">            - name: IP6_AUTODETECTION_METHOD</div><div class="line">              value: &quot;interface=eth1&quot;</div><div class="line">            - name: ETCD_CA_CERT_FILE</div><div class="line">              value: &quot;/etc/kubernetes/ssl/ca.pem&quot;</div><div class="line">            - name: ETCD_CERT_FILE</div><div class="line">              value: &quot;/etc/etcd/ssl/etcd.pem&quot;</div><div class="line">            - name: ETCD_KEY_FILE</div><div class="line">              value: &quot;/etc/etcd/ssl/etcd-key.pem&quot;</div><div class="line">          securityContext:</div><div class="line">            privileged: true</div><div class="line">          resources:</div><div class="line">            requests:</div><div class="line">              cpu: 250m</div><div class="line">          livenessProbe:</div><div class="line">            httpGet:</div><div class="line">              path: /liveness</div><div class="line">              port: 9099</div><div class="line">            periodSeconds: 10</div><div class="line">            initialDelaySeconds: 10</div><div class="line">            failureThreshold: 6</div><div class="line">          readinessProbe:</div><div class="line">            httpGet:</div><div class="line">              path: /readiness</div><div class="line">              port: 9099</div><div class="line">            periodSeconds: 10</div><div class="line">          volumeMounts:</div><div class="line">            - mountPath: /lib/modules</div><div class="line">              name: lib-modules</div><div class="line">              readOnly: true</div><div class="line">            - mountPath: /var/run/calico</div><div class="line">              name: var-run-calico</div><div class="line">              readOnly: false</div><div class="line">            - mountPath: /etc/etcd/ssl</div><div class="line">              name: etcd-ca-certs</div><div class="line">            - mountPath: /etc/kubernetes/ssl</div><div class="line">              name: kubernetes-ca-certs</div><div class="line">              readOnly: true</div><div class="line">        - name: install-cni</div><div class="line">          image: quay.io/calico/cni:v2.0.3</div><div class="line">          command: [&quot;/install-cni.sh&quot;]</div><div class="line">          env:</div><div class="line">            - name: CNI_CONF_NAME</div><div class="line">              value: &quot;10-calico.conflist&quot;</div><div class="line">            - name: ETCD_ENDPOINTS</div><div class="line">              valueFrom:</div><div class="line">                configMapKeyRef:</div><div class="line">                  name: calico-config</div><div class="line">                  key: etcd_endpoints</div><div class="line">            - name: CNI_NETWORK_CONFIG</div><div class="line">              valueFrom:</div><div class="line">                configMapKeyRef:</div><div class="line">                  name: calico-config</div><div class="line">                  key: cni_network_config</div><div class="line">          volumeMounts:</div><div class="line">            - mountPath: /host/opt/cni/bin</div><div class="line">              name: cni-bin-dir</div><div class="line">            - mountPath: /host/etc/cni/net.d</div><div class="line">              name: cni-net-dir</div><div class="line">      volumes:</div><div class="line">        - name: etcd-ca-certs</div><div class="line">          hostPath:</div><div class="line">            path: /etc/etcd/ssl</div><div class="line">            type: DirectoryOrCreate</div><div class="line">        - name: kubernetes-ca-certs</div><div class="line">          hostPath:</div><div class="line">            path: /etc/kubernetes/ssl</div><div class="line">            type: DirectoryOrCreate</div><div class="line">        - name: lib-modules</div><div class="line">          hostPath:</div><div class="line">            path: /lib/modules</div><div class="line">        - name: var-run-calico</div><div class="line">          hostPath:</div><div class="line">            path: /var/run/calico</div><div class="line">        - name: cni-bin-dir</div><div class="line">          hostPath:</div><div class="line">            path: /opt/cni/bin</div><div class="line">        - name: cni-net-dir</div><div class="line">          hostPath:</div><div class="line">            path: /etc/cni/net.d</div><div class="line">---</div><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: calico-kube-controllers</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    k8s-app: calico-kube-controllers</div><div class="line">spec:</div><div class="line">  replicas: 1</div><div class="line">  strategy:</div><div class="line">    type: Recreate</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      name: calico-kube-controllers</div><div class="line">      namespace: kube-system</div><div class="line">      labels:</div><div class="line">        k8s-app: calico-kube-controllers</div><div class="line">      annotations:</div><div class="line">        scheduler.alpha.kubernetes.io/critical-pod: &apos;&apos;</div><div class="line">    spec:</div><div class="line">      hostNetwork: true</div><div class="line">      tolerations:</div><div class="line">      - key: node.cloudprovider.kubernetes.io/uninitialized</div><div class="line">        value: &quot;true&quot;</div><div class="line">        effect: NoSchedule</div><div class="line">      - key: node-role.kubernetes.io/master</div><div class="line">        effect: NoSchedule</div><div class="line">      - key: CriticalAddonsOnly</div><div class="line">        operator: Exists</div><div class="line">      serviceAccountName: calico-kube-controllers</div><div class="line">      containers:</div><div class="line">        - name: calico-kube-controllers</div><div class="line">          image: quay.io/calico/kube-controllers:v2.0.2</div><div class="line">          env:</div><div class="line">            - name: ETCD_ENDPOINTS</div><div class="line">              valueFrom:</div><div class="line">                configMapKeyRef:</div><div class="line">                  name: calico-config</div><div class="line">                  key: etcd_endpoints</div><div class="line">            - name: ENABLED_CONTROLLERS</div><div class="line">              value: policy,profile,workloadendpoint,node</div><div class="line">            - name: ETCD_CA_CERT_FILE</div><div class="line">              value: &quot;/etc/kubernetes/ssl/ca.pem&quot;</div><div class="line">            - name: ETCD_CERT_FILE</div><div class="line">              value: &quot;/etc/etcd/ssl/etcd.pem&quot;</div><div class="line">            - name: ETCD_KEY_FILE</div><div class="line">              value: &quot;/etc/etcd/ssl/etcd-key.pem&quot;</div><div class="line">          volumeMounts:</div><div class="line">            - mountPath: /etc/etcd/ssl</div><div class="line">              name: etcd-ca-certs</div><div class="line">              readOnly: true</div><div class="line">            - mountPath: /etc/kubernetes/ssl</div><div class="line">              name: kubernetes-ca-certs</div><div class="line">              readOnly: true</div><div class="line">      volumes:</div><div class="line">        - name: etcd-ca-certs</div><div class="line">          hostPath:</div><div class="line">            path: /etc/etcd/ssl</div><div class="line">            type: DirectoryOrCreate</div><div class="line">        - name: kubernetes-ca-certs</div><div class="line">          hostPath:</div><div class="line">            path: /etc/kubernetes/ssl</div><div class="line">            type: DirectoryOrCreate</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: calico-cni-plugin</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: calico-cni-plugin</div><div class="line">subjects:</div><div class="line">- kind: ServiceAccount</div><div class="line">  name: calico-cni-plugin</div><div class="line">  namespace: kube-system</div><div class="line">---</div><div class="line">kind: ClusterRole</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line">  name: calico-cni-plugin</div><div class="line">rules:</div><div class="line">  - apiGroups: [&quot;&quot;]</div><div class="line">    resources:</div><div class="line">      - pods</div><div class="line">      - nodes</div><div class="line">    verbs:</div><div class="line">      - get</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line">  name: calico-cni-plugin</div><div class="line">  namespace: kube-system</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: calico-kube-controllers</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: calico-kube-controllers</div><div class="line">subjects:</div><div class="line">- kind: ServiceAccount</div><div class="line">  name: calico-kube-controllers</div><div class="line">  namespace: kube-system</div><div class="line">---</div><div class="line">kind: ClusterRole</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line">  name: calico-kube-controllers</div><div class="line">rules:</div><div class="line">  - apiGroups:</div><div class="line">    - &quot;&quot;</div><div class="line">    - extensions</div><div class="line">    resources:</div><div class="line">      - pods</div><div class="line">      - namespaces</div><div class="line">      - networkpolicies</div><div class="line">      - nodes</div><div class="line">    verbs:</div><div class="line">      - watch</div><div class="line">      - list</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line">  name: calico-kube-controllers</div><div class="line">  namespace: kube-system</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>安装插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ kubectl create -f /etc/kubernetes/network/calico.yml</div><div class="line">configmap &quot;calico-config&quot; created</div><div class="line">daemonset.extensions &quot;calico-node&quot; created</div><div class="line">deployment.extensions &quot;calico-kube-controllers&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;calico-cni-plugin&quot; created</div><div class="line">clusterrole.rbac.authorization.k8s.io &quot;calico-cni-plugin&quot; created</div><div class="line">serviceaccount &quot;calico-cni-plugin&quot; created</div><div class="line">clusterrolebinding.rbac.authorization.k8s.io &quot;calico-kube-controllers&quot; created</div><div class="line">clusterrole.rbac.authorization.k8s.io &quot;calico-kube-controllers&quot; created</div><div class="line">serviceaccount &quot;calico-kube-controllers&quot; created</div><div class="line"></div><div class="line">$ kubectl -n kube-system get po -l k8s-app=calico-node -o wide</div><div class="line">NAME                READY     STATUS    RESTARTS   AGE       IP              NODE</div><div class="line">calico-node-hjghp   2/2       Running   0          9m        192.168.56.16   kube-n3</div><div class="line">calico-node-jl9w2   2/2       Running   0          9m        192.168.56.12   kube-m2</div><div class="line">calico-node-k4lkr   2/2       Running   0          9m        192.168.56.14   kube-n1</div><div class="line">calico-node-kj9xd   2/2       Running   0          9m        192.168.56.15   kube-n2</div><div class="line">calico-node-mf2xv   2/2       Running   0          9m        192.168.56.11   kube-m1</div><div class="line">calico-node-p8pqq   2/2       Running   0          9m        192.168.56.13   kube-m3</div></pre></td></tr></table></figure>
<p>查看刚刚 DNS 处于 Pending 的 Pod 是否已经启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kubectl -n kube-system get po -l k8s-app=kube-dns</div><div class="line">NAME                        READY     STATUS    RESTARTS   AGE</div><div class="line">kube-dns-654684d656-vzkjk   3/3       Running   0          25m</div></pre></td></tr></table></figure>
<p>在 kube-m1 下载 Calico CLI 来查看 Calico nodes:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">$ wget https://github.com/projectcalico/calicoctl/releases/download/v3.1.0/calicoctl -O /usr/local/bin/calicoctl</div><div class="line"></div><div class="line">$ chmod u+x /usr/local/bin/calicoctl</div><div class="line"></div><div class="line">$ cat &lt;&lt;EOF &gt; ~/calico-rc</div><div class="line">export ETCD_ENDPOINTS=&quot;https://192.168.56.11:2379,https://192.168.56.12:2379,https://192.168.56.13:2379&quot;</div><div class="line">export ETCD_CA_CERT_FILE=&quot;/etc/kubernetes/ssl/ca.pem&quot;</div><div class="line">export ETCD_CERT_FILE=&quot;/etc/etcd/ssl/etcd.pem&quot;</div><div class="line">export ETCD_KEY_FILE=&quot;/etc/etcd/ssl/etcd-key.pem&quot;</div><div class="line">EOF</div><div class="line"></div><div class="line">$ calicoctl node status</div><div class="line">Calico process is running.</div><div class="line"></div><div class="line">IPv4 BGP status</div><div class="line">+---------------+-------------------+-------+----------+-------------+</div><div class="line">| PEER ADDRESS  |     PEER TYPE     | STATE |  SINCE   |    INFO     |</div><div class="line">+---------------+-------------------+-------+----------+-------------+</div><div class="line">| 192.168.56.12 | node-to-node mesh | up    | 06:59:37 | Established |</div><div class="line">| 192.168.56.13 | node-to-node mesh | up    | 06:59:38 | Established |</div><div class="line">| 192.168.56.14 | node-to-node mesh | up    | 07:04:57 | Established |</div><div class="line">| 192.168.56.15 | node-to-node mesh | up    | 07:06:35 | Established |</div><div class="line">| 192.168.56.16 | node-to-node mesh | up    | 07:07:06 | Established |</div><div class="line">+---------------+-------------------+-------+----------+-------------+</div><div class="line"></div><div class="line">IPv6 BGP status</div><div class="line">No IPv6 peers found.</div></pre></td></tr></table></figure>
  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#部署-Node"><span class="toc-number">1.</span> <span class="toc-text">部署 Node</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署与设定"><span class="toc-number">1.1.</span> <span class="toc-text">部署与设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证集群"><span class="toc-number">1.2.</span> <span class="toc-text">验证集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-Core-Addons-部署"><span class="toc-number">1.3.</span> <span class="toc-text">Kubernetes Core Addons 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes-Proxy"><span class="toc-number">1.3.1.</span> <span class="toc-text">Kubernetes Proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes-DNS"><span class="toc-number">1.3.2.</span> <span class="toc-text">Kubernetes DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Calico-Network-安装与设定"><span class="toc-number">1.3.3.</span> <span class="toc-text">Calico Network 安装与设定</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&text=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&is_video=false&description=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node&body=Check out this article: xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&title=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xiaofeise.com/2018/05/30/虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node/&name=虚拟机部署 Kubernetes v1.10.3  高可用集群 - 04 部署 Node&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 萧非瑟 <a href="http://www.miitbeian.gov.cn">粤ICP备17119417号-1</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


